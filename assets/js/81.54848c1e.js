(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{742:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h4",{attrs:{id:"慢查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢查询"}},[s._v("#")]),s._v(" 慢查询")]),s._v(" "),t("h6",{attrs:{id:"_1、查询慢查询日志的开启情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、查询慢查询日志的开启情况"}},[s._v("#")]),s._v(" 1、查询慢查询日志的开启情况")]),s._v(" "),t("p",[t("code",[s._v("show variables like '%slow_query_log%';")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow_query_log%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------------+--------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+--------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" OFF                                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" slow_query_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /var/lib/Mysql/5456c158870a-slow.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------------+--------------------------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("slow_query_log：慢查询开启状态。")]),s._v(" "),t("p",[s._v("slow_query_log_file：慢查询日志存放位置")]),s._v(" "),t("h6",{attrs:{id:"_2、开启慢查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、开启慢查询"}},[s._v("#")]),s._v(" 2、开启慢查询")]),s._v(" "),t("ul",[t("li",[s._v("方式一：")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启慢查询")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ON'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置执行时间阈值，这里设置超过1s的都将记录到慢查询日志中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" global "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("此方式不需要重启mysql")]),s._v(" "),t("ul",[t("li",[s._v("方式二：")])]),s._v(" "),t("p",[s._v("在my.cnf配置文件中添加以下配置，更改配置后需要重启mysql。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启慢查询")]),s._v("\nslow_query_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置慢查询时间 1 s")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 慢查询日志保存路径")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"D:/soft/xampp/mysql/logs/slow_query.log"')]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录没有使用索引查询语句")]),s._v("\nlog-queries-not-using-indexes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("3、查看慢查询日志")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://markdown-1301775995.cos.ap-nanjing.myqcloud.com/image-20210312161154450.png",alt:"image-20210312161154450"}})]),s._v(" "),t("p",[s._v("4、通过工具分析慢查询日志")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("mysqldumpslow")]),s._v("："),t("code",[s._v("mysql")]),s._v("自身提供的日志分析工具")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqldumpslow --help")]),s._v("\nUsage: mysqldumpslow "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" OPTS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" LOGS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nParse and summarize the MySQL slow query log. Options are\n\n  --verbose    verbose\n  --debug      debug\n  --help       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" this text to standard output\n\n  -v           verbose\n  -d           debug\n  -s ORDER     what to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" by "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("al, at, ar, c, l, r, t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'at'")]),s._v(" is default\n                al: average lock "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n                ar: average rows sent\n                at: average query "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n                 c: count\n                 l: lock "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n                 r: rows sent\n                 t: query "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n  -r           reverse the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" order "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("largest last instead of first"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -t NUM       just show the "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" n queries\n  -a           don"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t abstract all numbers to N and strings to '")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n  -n NUM       abstract numbers with at least n digits within names\n  -g PATTERN   grep: only consider stmts that include this string\n  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),\n               default is '")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("', i.e. match all\n  -i NAME      name of server instance (if using Mysql.server startup script)\n  -l           don'")]),s._v("t subtract lock "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" from total "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("-s, 是表示按照何种方式排序\n   c: 访问计数\n   l: 锁定时间\n   r: 返回记录\n   t: 查询时间\n   al:平均锁定时间\n   ar:平均返回记录数\n   at:平均查询时间\n-r, 倒序排列\n-a，不将所有数字抽象为N，以及字符串抽象成S。查询时不加-a参数，所有数字都会被抽象化成N，如下例图\n-t, 是top n的意思，即为返回前面多少条的数据；\n-g, 后边可以写一个正则匹配模式，大小写不敏感的；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://markdown-1301775995.cos.ap-nanjing.myqcloud.com/image-20210312162226004.png",alt:"image-20210312162226004"}})]),s._v(" "),t("ul",[t("li",[s._v("pt-query-digest（后续更新）")])])])}),[],!1,null,null,null);a.default=e.exports}}]);